@{
    ViewData["Title"] = "Gi·∫£i th√≠ch DI Lifetime";
}

<h2>@ViewData["Title"]</h2>

<div class="row">
    <div class="col-md-12">
        <div class="alert alert-primary">
            <h4>üéØ Dependency Injection Lifetime trong ASP.NET Core</h4>
            <p class="mb-0">
                ASP.NET Core cung c·∫•p 3 lo·∫°i lifetime cho Dependency Injection: 
                <strong>Transient</strong>, <strong>Scoped</strong>, v√† <strong>Singleton</strong>
            </p>
        </div>

        <!-- Transient -->
        <div class="card mb-4 border-danger">
            <div class="card-header bg-danger text-white">
                <h3 class="mb-0">1Ô∏è‚É£ Transient Lifetime</h3>
            </div>
            <div class="card-body">
                <h5>üìå ƒê·∫∑c ƒëi·ªÉm:</h5>
                <ul>
                    <li>T·∫°o instance <strong>M·ªöI</strong> m·ªói l·∫ßn service ƒë∆∞·ª£c inject</li>
                    <li>M·ªói l·∫ßn DI container resolve service, s·∫Ω t·∫°o m·ªôt object m·ªõi</li>
                    <li>Lightweight services, kh√¥ng gi·ªØ state</li>
                </ul>

                <h5>üí° V√≠ d·ª• trong Lab:</h5>
                <pre class="bg-light p-3"><code>builder.Services.AddTransient&lt;IEmailService, EmailService&gt;();</code></pre>

                <div class="alert alert-warning">
                    <strong>K·∫øt qu·∫£ quan s√°t:</strong>
                    <ul class="mb-0">
                        <li><code>EmailService1Id</code> ‚â† <code>EmailService2Id</code></li>
                        <li>D√π c√πng inject v√†o 1 controller, nh∆∞ng v√¨ l√† Transient n√™n c√≥ 2 instance kh√°c nhau</li>
                        <li>M·ªói l·∫ßn refresh trang, c·∫£ 2 ID ƒë·ªÅu thay ƒë·ªïi</li>
                    </ul>
                </div>

                <h5>‚úÖ Khi n√†o d√πng Transient?</h5>
                <ul class="mb-0">
                    <li>Services stateless, kh√¥ng l∆∞u tr·ªØ d·ªØ li·ªáu</li>
                    <li>Services nh·∫π, t·∫°o nhanh</li>
                    <li>V√≠ d·ª•: EmailService, NotificationService, HelperService</li>
                </ul>
            </div>
        </div>

        <!-- Scoped -->
        <div class="card mb-4 border-warning">
            <div class="card-header bg-warning text-dark">
                <h3 class="mb-0">2Ô∏è‚É£ Scoped Lifetime</h3>
            </div>
            <div class="card-body">
                <h5>üìå ƒê·∫∑c ƒëi·ªÉm:</h5>
                <ul>
                    <li>T·∫°o instance m·ªõi cho m·ªói <strong>request (scope)</strong></li>
                    <li>Trong c√πng 1 request, t·∫•t c·∫£ c√°c l·∫ßn inject s·∫Ω d√πng chung 1 instance</li>
                    <li>Request kh√°c nhau ‚Üí instance kh√°c nhau</li>
                </ul>

                <h5>üí° V√≠ d·ª• trong Lab:</h5>
                <pre class="bg-light p-3"><code>builder.Services.AddScoped&lt;IUserService, UserService&gt;();</code></pre>

                <div class="alert alert-warning">
                    <strong>K·∫øt qu·∫£ quan s√°t:</strong>
                    <ul class="mb-0">
                        <li><code>UserServiceId</code> gi·ªëng nhau trong c√πng 1 l·∫ßn load trang</li>
                        <li>Khi refresh (F5) ‚Üí request m·ªõi ‚Üí <code>UserServiceId</code> thay ƒë·ªïi</li>
                        <li>M·ªü nhi·ªÅu tab ‚Üí m·ªói tab c√≥ request ri√™ng ‚Üí ServiceId kh√°c nhau gi·ªØa c√°c tab</li>
                    </ul>
                </div>

                <h5>‚úÖ Khi n√†o d√πng Scoped?</h5>
                <ul class="mb-0">
                    <li><strong>DbContext</strong> (khuy·∫øn ngh·ªã t·ª´ Microsoft)</li>
                    <li>Services c·∫ßn maintain state trong 1 request</li>
                    <li>Repository pattern, Unit of Work</li>
                    <li>V√≠ d·ª•: UserService, ShoppingCartService (trong 1 request)</li>
                </ul>
            </div>
        </div>

        <!-- Singleton -->
        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0">3Ô∏è‚É£ Singleton Lifetime</h3>
            </div>
            <div class="card-body">
                <h5>üìå ƒê·∫∑c ƒëi·ªÉm:</h5>
                <ul>
                    <li>T·∫°o <strong>DUY NH·∫§T 1 instance</strong> su·ªët application lifetime</li>
                    <li>Instance ƒë∆∞·ª£c t·∫°o l·∫ßn ƒë·∫ßu ti√™n khi app kh·ªüi ƒë·ªông (ho·∫∑c l·∫ßn ƒë·∫ßu request)</li>
                    <li>T·∫•t c·∫£ requests, t·∫•t c·∫£ users ƒë·ªÅu d√πng chung instance n√†y</li>
                </ul>

                <h5>üí° V√≠ d·ª• trong Lab:</h5>
                <pre class="bg-light p-3"><code>builder.Services.AddSingleton&lt;ILoggingService, LoggingService&gt;();</code></pre>

                <div class="alert alert-warning">
                    <strong>K·∫øt qu·∫£ quan s√°t:</strong>
                    <ul class="mb-0">
                        <li><code>LoggingServiceId</code> <strong>KH√îNG BAO GI·ªú THAY ƒê·ªîI</strong></li>
                        <li>D√π refresh bao nhi√™u l·∫ßn, ID v·∫´n gi·ªØ nguy√™n</li>
                        <li>Logs ƒë∆∞·ª£c t√≠ch l≈©y qua c√°c request (state ƒë∆∞·ª£c gi·ªØ l·∫°i)</li>
                        <li>Ch·ªâ thay ƒë·ªïi khi restart application</li>
                    </ul>
                </div>

                <h5>‚úÖ Khi n√†o d√πng Singleton?</h5>
                <ul class="mb-0">
                    <li>Services c·∫ßn share state gi·ªØa to√†n b·ªô app</li>
                    <li>Services t·ªën t√†i nguy√™n ƒë·ªÉ kh·ªüi t·∫°o</li>
                    <li>Configuration services, Caching services</li>
                    <li>Logging services, Monitoring services</li>
                    <li>V√≠ d·ª•: LoggingService, CacheService, ConfigurationService</li>
                </ul>

                <div class="alert alert-danger">
                    <strong>‚ö†Ô∏è L∆∞u √Ω:</strong>
                    <ul class="mb-0">
                        <li>Singleton ph·∫£i thread-safe (an to√†n ƒëa lu·ªìng)</li>
                        <li>Kh√¥ng inject Scoped service v√†o Singleton (s·∫Ω g√¢y l·ªói)</li>
                        <li>C·∫©n th·∫≠n v·ªõi memory leaks v√¨ object t·ªìn t·∫°i su·ªët app lifetime</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Comparison Table -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h3 class="mb-0">üìä B·∫£ng so s√°nh</h3>
            </div>
            <div class="card-body">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>ƒê·∫∑c ƒëi·ªÉm</th>
                            <th>Transient</th>
                            <th>Scoped</th>
                            <th>Singleton</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Th·ªùi gian s·ªëng</strong></td>
                            <td>M·ªói l·∫ßn inject</td>
                            <td>M·ªói request</td>
                            <td>To√†n b·ªô app</td>
                        </tr>
                        <tr>
                            <td><strong>S·ªë instance</strong></td>
                            <td>Nhi·ªÅu</td>
                            <td>1 per request</td>
                            <td>Duy nh·∫•t 1</td>
                        </tr>
                        <tr>
                            <td><strong>State</strong></td>
                            <td>Kh√¥ng gi·ªØ state</td>
                            <td>Gi·ªØ trong request</td>
                            <td>Gi·ªØ su·ªët app</td>
                        </tr>
                        <tr>
                            <td><strong>Thread-safe</strong></td>
                            <td>Kh√¥ng c·∫ßn</td>
                            <td>Kh√¥ng c·∫ßn</td>
                            <td>B·∫ÆT BU·ªòC</td>
                        </tr>
                        <tr>
                            <td><strong>Memory</strong></td>
                            <td>Nh·∫π nh·∫•t</td>
                            <td>Trung b√¨nh</td>
                            <td>N·∫∑ng nh·∫•t</td>
                        </tr>
                        <tr>
                            <td><strong>V√≠ d·ª•</strong></td>
                            <td>EmailService</td>
                            <td>DbContext, UserService</td>
                            <td>LoggingService</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Back Button -->
        <div class="text-center">
            <a asp-action="Index" class="btn btn-primary btn-lg">‚Üê Quay l·∫°i Demo</a>
        </div>
    </div>
</div>
